<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap.min.css">
    <title>What do you meme!</title>
</head>

<body>
    <div class="container">
        <div class="row m-2">
            <div class="col-12">
                <a href="allpictures.html" class="btn btn-primary" role="button">alle Pictures</a>
                <a href="allquotes.html" class="btn btn-primary" role="button">alle Quotes</a>
                <a href="allmemes.html" class="btn btn-primary" role="button">alle Memes</a>
            </div>
            <div class="row">
                <div class="text-center">
                    <div id="memepicture"></div>
                    <h2 class="m-4">Choose a quote to the picture</h2>
                </div>
            </div>
            <div id="memequotes" class="row"></div>
        </div>



</body>
<script>

    getRandomPicture();
    getRandomQuotes();

    async function getRandomQuotes() {
        let response = await fetch('http://localhost:8080/api/whatdoyoumeme/quotes/random4',
            {
                method: 'GET',
                cache: 'no-cache',
                headers: {
                    'Accept': 'application/json'
                }
            }
        );
        let data = await response.json();

        var memequotes = document.getElementById('memequotes');

        data.forEach((randomquote) => {
            let col = document.createElement('div');
            col.classList.add('col-3');

            let carddiv = document.createElement("div");
            carddiv.classList.add('card', 'bg-primary');
            carddiv.style = 'width: 18rem';

            let cardbody = document.createElement("div");
            cardbody.classList.add('card-body', 'text-white');

            let quote = document.createElement("p");
            quote.classList.add('card-text');
            quote.appendChild(document.createTextNode(randomquote.text));

            let likes = document.createElement("button");
            let pid = document.getElementById("pid").innerHTML;
            likes.addEventListener("click", function match() { matching(randomquote.id, pid); });
            likes.innerHTML = "Add me!";
            likes.classList.add('btn', 'btn-light');

            memequotes.appendChild(col);
            col.appendChild(carddiv);
            carddiv.appendChild(cardbody);
            cardbody.appendChild(quote);
            cardbody.appendChild(likes);

        })


    }

    async function getRandomPicture() {
        fetch('http://localhost:8080/api/whatdoyoumeme/pictures/random1', {
            method: 'GET'
        })
            .then(response => response.json())
            .then(randompic => {
                let memepicture = document.getElementById("memepicture");


                let col = document.createElement('div');
                col.classList.add('col-12', 'm-4', 'text-center');

                let picture = document.createElement("img");
                picture.src = randompic.url;
                picture.classList.add('rounded')
                picture.style.height = "300px"

                let pid = document.createElement("p");
                pid.setAttribute("id", "pid");
                pid.innerHTML = randompic.id;
                pid.hidden = true;

                memepicture.appendChild(col);
                col.appendChild(picture);
                col.appendChild(pid);

            })
    }

    async function matching(qid, pid) {
        fetch('http://localhost:8080/api/whatdoyoumeme/memes/' + pid + '/' + qid, {
            method: 'GET'
        })
            .then(response => response.status == 200 ? document.location.reload() : console.log(response.status));
    }
</script>

</html>